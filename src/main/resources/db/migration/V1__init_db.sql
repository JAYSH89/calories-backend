CREATE TABLE IF NOT EXISTS users (id uuid PRIMARY KEY, email VARCHAR(100) NOT NULL, "password" VARCHAR(100) NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL);
ALTER TABLE users ADD CONSTRAINT users_email_unique UNIQUE (email);
CREATE TABLE IF NOT EXISTS user_profile (id uuid PRIMARY KEY, sex INT NOT NULL, height INT NOT NULL, activity_type INT NOT NULL, birthday DATE NOT NULL, body_fat INT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, user_id uuid NOT NULL, CONSTRAINT fk_user_profile_user_id__id FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE RESTRICT);
ALTER TABLE user_profile ADD CONSTRAINT user_profile_user_id_unique UNIQUE (user_id);
CREATE TABLE IF NOT EXISTS weight_measurements (id uuid PRIMARY KEY, weight DOUBLE PRECISION NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, user_id uuid NOT NULL, CONSTRAINT fk_weight_measurements_user_id__id FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE RESTRICT);
CREATE TABLE IF NOT EXISTS categories (id uuid PRIMARY KEY, "name" VARCHAR(64) NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, user_id uuid NOT NULL, CONSTRAINT fk_categories_user_id__id FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE RESTRICT);
ALTER TABLE categories ADD CONSTRAINT categories_name_user_id_unique UNIQUE ("name", user_id);
CREATE TABLE IF NOT EXISTS tags (id uuid PRIMARY KEY, "name" VARCHAR(64) NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, user_id uuid NOT NULL, CONSTRAINT fk_tags_user_id__id FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE RESTRICT);
ALTER TABLE tags ADD CONSTRAINT tags_name_user_id_unique UNIQUE ("name", user_id);
CREATE TABLE IF NOT EXISTS foods (id uuid PRIMARY KEY, "name" VARCHAR(64) NOT NULL, carbs DOUBLE PRECISION NOT NULL, proteins DOUBLE PRECISION NOT NULL, fats DOUBLE PRECISION NOT NULL, amount DOUBLE PRECISION NOT NULL, amount_type INT NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, user_id uuid NOT NULL, CONSTRAINT fk_foods_user_id__id FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE RESTRICT);
ALTER TABLE foods ADD CONSTRAINT foods_name_user_id_unique UNIQUE ("name", user_id);
